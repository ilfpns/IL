> **MCU가 쓰는 메모리**
[[OS]]
---

### 1. Flash

- 역할 : 프로그램 코드, 상수 저장
- 특징 : 비휘발성, 느림, 보통 XIP 실행
- 사용 예 : `const`

### 2. SRAM

- 역할 : 실행 중인 데이터
- 특징 : 휘발, 빠름 (1cycle), 용량 작음
- DMA/ISR 핵심 메모리

### 3. 특수 SRAM

**용도/연결이 다름**

- **TCM / CCM SRAM (STM32)**
    - CPU 전용, 초저지연
    - DMA 접근 불가인 경우 많음
- **IRAM / DRAM (ESP32)**
    - IRAM: 코드 실행용 SRAM
    - DRAM: 데이터용 SRAM

### 4. NVC

- 역할 : 중요 데이터 저장
- 특징 : 블록 단위 erase, 쓰기 느림

> **DMA**

---

⇒ CPU 동작 없이 주변장치들이 메모리에 직접 접근하여 읽거나 쓸 수 있도록 하는 기능

⇒ CPU의 개입 없이 I/O 장치와 기억장치 사이의 데이터를 전송하는 접근 방식

⇒ CPU 대신 버스를 잡고 데이터만 옮기는 하드웨어 엔진

### 배경

- PIO
    
    CPU가 주변장치와 데이터를 주고받는 방식으로 효율이 떨어진다
    

를 극복하기 위해 DMA가 개발됨

### 특징

- CPU를 개입시키지 않고, 대신 일을 처리한다는 점이 중요하다

### 동작 모드

<aside>

CPU 명령 → 버스 사용 요구 → 버스 사용 허가 → 데이터 전송 → 인터럽트

</aside>

- 사이클 스틸링
    
    - 인터럽트와는 다른 개념
    
    ⇒ 인터럽트는 처리 기간 동안 정지함
    

⇒ CPU가 DMA에 우선순위를 양보

- 1 Cycle 정지
    
- 빠른 입출력 가능
    
- 버스트 모드
    
    DMA가 버스 사용권 획득 시 데이터 전송 완료까지 버스 사이클 독점, 블록 단위 데이터 전송
    

### 채널 제어 방식

⇒ 여러 장치가 채널 제어기에 입출력 명령을 전달하여 CPU 개입 없이 입출력을 수행

### DMA가 못 가는 메모리

- CCM / TCM / 일부 IRAM
- 캐시 뒤쪽 메모리 (ESP32, Cortex-M7)

⇒ DMA는 SRAM에만 접근

### Cache와 DMA

- DMA는 캐시를 모름
- CPU는 캐시만 봄

⇒ DMA가 쓴 데이터가 있지만 CPU는 이전 값을 읽음

### Stream과 Channel

- 같은 Channel
- 같은 Stream
- 동시에 사용 불가

⇒ HAL에서 “BUSY” 뜨는 이유

---

![[Pasted image 20260115224454.png]]

### CH :

주변장치의 DMA 요청 신호선

어느 주변장치가 DMA를 요청했는지를 구분하기 위핸 ID + 배선

### Stream :

실제 DMA 전송을 수행하는 하드웨어 엔진

- Stream이 하는 일
    - 소스 주소 생성
    - 목적지 주소 생성
    - 전송 크기 관리
    - 주소 증가/고정 처리
    - FIFO 사용 여부 판단
    - 버스트 제어
    - 완료/에러 상태 생성

데이터 버스 사용

실제 데이터 이동을 수행하는 DMA 실행 유닛

### FIFO :

Stream 내부에 있느 임시 데이터 버퍼

- 전송 효율과 안정성을 위한 내부 버퍼
    - 메모리와 주변기기의 속도·폭 불일치 흡수
    - 버스트 전송 지원
    - 데이터 폭 변환(byte ↔ word 등)

### Arbiter :

여러 Stream이 동시에 전송을 요청할 때, 아딴 Stream이 AHB 버스를 사용할지 결정하는 하드웨어 로직